<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout - TechHub</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/nav-links.css">
</head>

<body>
    <!-- Header -->
    <header class="header">
        <nav class="navbar">
            <div class="nav-container">
                <div class="nav-brand">
                    <i class="fas fa-microchip"></i>
                    <span>TechHub</span>
                </div>

                <div class="nav-menu">
                    <a href="index.html" class="nav-link">Início</a>
                    <a href="produtos.html" class="nav-link">Produtos</a>
                    <a href="sobre.html" class="nav-link">Sobre</a>
                    <a href="contato.html" class="nav-link">Contato</a>
                </div>

                <div class="nav-actions">
                    <div class="cart-icon" id="cartIcon">
                        <i class="fas fa-shopping-cart"></i>
                        <span class="cart-count" id="cartCount">0</span>
                    </div>
                    <div class="mobile-menu-toggle" id="mobileMenuToggle">
                        <i class="fas fa-bars"></i>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    
    <div class="checkout-progress">
        <div class="container">
            <div class="progress-steps">
                <div class="step active" data-step="1">
                    <div class="step-icon">
                        <i class="fas fa-shopping-cart"></i>
                    </div>
                    <span class="step-label">Carrinho</span>
                </div>
                <div class="step active" data-step="2">
                    <div class="step-icon">
                        <i class="fas fa-user"></i>
                    </div>
                    <span class="step-label">Identificação</span>
                </div>
                <div class="step" data-step="3">
                    <div class="step-icon">
                        <i class="fas fa-credit-card"></i>
                    </div>
                    <span class="step-label">Pagamento</span>
                </div>
                <div class="step" data-step="4">
                    <div class="step-icon">
                        <i class="fas fa-check"></i>
                    </div>
                    <span class="step-label">Confirmação</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Checkout -->
    <section class="checkout-section">
        <div class="container">
            <h1 class="section-title">Finalizar Compra</h1>

            <div class="checkout-container">
                <!-- Formulário de Checkout -->
                <div class="checkout-form">
                    <form id="checkoutForm" class="checkout-form-content">
                        <!-- Dados Pessoais -->
                        <div class="form-section">
                            <h3 class="form-section-title">
                                <i class="fas fa-user"></i>
                                Dados Pessoais
                            </h3>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="nomeCompleto">Nome Completo *</label>
                                    <input type="text" id="nomeCompleto" name="nomeCompleto" required>
                                </div>
                                <div class="form-group">
                                    <label for="cpf">CPF *</label>
                                    <input type="text" id="cpf" name="cpf" maxlength="14" required>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="email">E-mail *</label>
                                    <input type="email" id="email" name="email" required>
                                </div>
                                <div class="form-group">
                                    <label for="telefone">Telefone *</label>
                                    <input type="tel" id="telefone" name="telefone" maxlength="15" required>
                                </div>
                            </div>
                        </div>

                        <!-- Endereço de Entrega -->
                        <div class="form-section">
                            <h3 class="form-section-title">
                                <i class="fas fa-map-marker-alt"></i>
                                Endereço de Entrega
                            </h3>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="cep">CEP *</label>
                                    <input type="text" id="cep" name="cep" maxlength="9" required>
                                </div>
                                <div class="form-group">
                                    <label for="endereco">Endereço *</label>
                                    <input type="text" id="endereco" name="endereco" required>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="numero">Número *</label>
                                    <input type="text" id="numero" name="numero" required>
                                </div>
                                <div class="form-group">
                                    <label for="complemento">Complemento</label>
                                    <input type="text" id="complemento" name="complemento">
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="bairro">Bairro *</label>
                                    <input type="text" id="bairro" name="bairro" required>
                                </div>
                                <div class="form-group">
                                    <label for="cidade">Cidade *</label>
                                    <input type="text" id="cidade" name="cidade" required>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="estado">Estado *</label>
                                    <select id="estado" name="estado" required>
                                        <option value="">Selecione...</option>
                                        <option value="AC">Acre</option>
                                        <option value="AL">Alagoas</option>
                                        <option value="AP">Amapá</option>
                                        <option value="AM">Amazonas</option>
                                        <option value="BA">Bahia</option>
                                        <option value="CE">Ceará</option>
                                        <option value="DF">Distrito Federal</option>
                                        <option value="ES">Espírito Santo</option>
                                        <option value="GO">Goiás</option>
                                        <option value="MA">Maranhão</option>
                                        <option value="MT">Mato Grosso</option>
                                        <option value="MS">Mato Grosso do Sul</option>
                                        <option value="MG">Minas Gerais</option>
                                        <option value="PA">Pará</option>
                                        <option value="PB">Paraíba</option>
                                        <option value="PR">Paraná</option>
                                        <option value="PE">Pernambuco</option>
                                        <option value="PI">Piauí</option>
                                        <option value="RJ">Rio de Janeiro</option>
                                        <option value="RN">Rio Grande do Norte</option>
                                        <option value="RS">Rio Grande do Sul</option>
                                        <option value="RO">Rondônia</option>
                                        <option value="RR">Roraima</option>
                                        <option value="SC">Santa Catarina</option>
                                        <option value="SP">São Paulo</option>
                                        <option value="SE">Sergipe</option>
                                        <option value="TO">Tocantins</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Forma de Pagamento -->
                        <div class="form-section">
                            <h3 class="form-section-title">
                                <i class="fas fa-credit-card"></i>
                                Forma de Pagamento
                            </h3>

                            <div class="payment-methods">
                                <div class="payment-method">
                                    <input type="radio" id="cartao" name="pagamento" value="cartao" checked>
                                    <label for="cartao" class="payment-label">
                                        <i class="fas fa-credit-card"></i>
                                        <div>
                                            <strong>Cartão de Crédito</strong>
                                            <small>Até 12x sem juros</small>
                                        </div>
                                    </label>
                                </div>

                                <div class="payment-method">
                                    <input type="radio" id="boleto" name="pagamento" value="boleto">
                                    <label for="boleto" class="payment-label">
                                        <i class="fas fa-barcode"></i>
                                        <div>
                                            <strong>Boleto Bancário</strong>
                                            <small>Desconto de 5%</small>
                                        </div>
                                    </label>
                                </div>

                                <div class="payment-method">
                                    <input type="radio" id="pix" name="pagamento" value="pix">
                                    <label for="pix" class="payment-label">
                                        <i class="fas fa-qrcode"></i>
                                        <div>
                                            <strong>PIX</strong>
                                            <small>Desconto de 10%</small>
                                        </div>
                                    </label>
                                </div>
                            </div>

                            <!-- Detalhes do Cartão -->
                            <div id="cartaoDetalhes" class="payment-details">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="numeroCartao">Número do Cartão *</label>
                                        <input type="text" id="numeroCartao" name="numeroCartao" maxlength="19"
                                            placeholder="0000 0000 0000 0000">
                                    </div>
                                    <div class="form-group">
                                        <label for="nomeCartao">Nome no Cartão *</label>
                                        <input type="text" id="nomeCartao" name="nomeCartao">
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="validadeCartao">Validade *</label>
                                        <input type="text" id="validadeCartao" name="validadeCartao" maxlength="5"
                                            placeholder="MM/AA">
                                    </div>
                                    <div class="form-group">
                                        <label for="cvvCartao">CVV *</label>
                                        <input type="text" id="cvvCartao" name="cvvCartao" maxlength="4"
                                            placeholder="000">
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="parcelas">Parcelamento *</label>
                                        <select id="parcelas" name="parcelas">
                                            <option value="1">1x de R$ 0,00 sem juros</option>
                                            <option value="2">2x de R$ 0,00 sem juros</option>
                                            <option value="3">3x de R$ 0,00 sem juros</option>
                                            <option value="4">4x de R$ 0,00 sem juros</option>
                                            <option value="5">5x de R$ 0,00 sem juros</option>
                                            <option value="6">6x de R$ 0,00 sem juros</option>
                                            <option value="7">7x de R$ 0,00 sem juros</option>
                                            <option value="8">8x de R$ 0,00 sem juros</option>
                                            <option value="9">9x de R$ 0,00 sem juros</option>
                                            <option value="10">10x de R$ 0,00 sem juros</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Observações -->
                        <div class="form-section">
                            <h3 class="form-section-title">
                                <i class="fas fa-comment"></i>
                                Observações
                            </h3>

                            <div class="form-group">
                                <label for="observacoes">Observações do Pedido</label>
                                <textarea id="observacoes" name="observacoes" rows="4"
                                    placeholder="Alguma observação importante sobre seu pedido?"></textarea>
                            </div>
                        </div>

                        <!-- Termos e Condições -->
                        <div class="form-section">
                            <div class="checkbox-group">
                                <input type="checkbox" id="termos" name="termos" required>
                                <label for="termos">
                                    Li e concordo com os <a href="#" target="_blank">termos de uso</a> e <a href="#"
                                        target="_blank">política de privacidade</a> *
                                </label>
                            </div>
                        </div>

                        <!-- Botão Finalizar -->
                        <div class="form-actions">
                            <button type="submit" class="btn-primary btn-large">
                                <i class="fas fa-check"></i>
                                Finalizar Pedido
                            </button>
                            <a href="carrinho.html" class="btn-secondary">
                                <i class="fas fa-arrow-left"></i>
                                Voltar ao Carrinho
                            </a>
                        </div>
                    </form>
                </div>

                <!-- Resumo do Pedido -->
                <div class="checkout-resumo">
                    <div class="resumo-header">
                        <h3>Resumo do Pedido</h3>
                        <a href="carrinho.html" class="editar-carrinho">
                            <i class="fas fa-edit"></i> Editar
                        </a>
                    </div>

                    <div class="resumo-itens" id="resumoItens">
                        <!-- Itens do resumo serão carregados via JavaScript -->
                    </div>

                    <div class="resumo-cupom">
                        <div class="cupom-input-group">
                            <input type="text" id="cupomCheckout" placeholder="Cupom de desconto">
                            <button id="aplicarCupomCheckout" class="btn-secondary">
                                Aplicar
                            </button>
                        </div>
                    </div>

                    <div class="resumo-frete">
                        <div class="frete-info">
                            <i class="fas fa-truck"></i>
                            <span id="freteTexto">Frete grátis para todo Brasil</span>
                        </div>
                    </div>

                    <div class="resumo-total" id="resumoTotal">
                        <div class="total-item">
                            <span>Subtotal</span>
                            <span id="subtotal">R$ 0,00</span>
                        </div>
                        <div class="total-item" id="descontoItem" style="display: none;">
                            <span>Desconto</span>
                            <span id="desconto">R$ 0,00</span>
                        </div>
                        <div class="total-item">
                            <span>Frete</span>
                            <span id="frete">Grátis</span>
                        </div>
                        <div class="total-item final">
                            <span>Total</span>
                            <span id="total">R$ 0,00</span>
                        </div>
                    </div>

                    <div class="resumo-seguranca">
                        <div class="seguranca-item">
                            <i class="fas fa-lock"></i>
                            <span>Compra 100% segura</span>
                        </div>
                        <div class="seguranca-item">
                            <i class="fas fa-shield-alt"></i>
                            <span>Seus dados estão protegidos</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>TechHub</h4>
                    <p>Sua loja especializada em peças de computador com as melhores marcas e preços do mercado.</p>
                    <div class="social-links">
                        <a href="#"><i class="fab fa-facebook"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-youtube"></i></a>
                    </div>
                </div>

                <div class="footer-section">
                    <h4>Categorias</h4>
                    <ul>
                        <li><a href="#">Processadores</a></li>
                        <li><a href="#">Placas de Vídeo</a></li>
                        <li><a href="#">Memória RAM</a></li>
                        <li><a href="#">Armazenamento</a></li>
                        <li><a href="#">Placas-mãe</a></li>
                    </ul>
                </div>

                <div class="footer-section">
                    <h4>Institucional</h4>
                    <ul>
                        <li><a href="#">Sobre Nós</a></li>
                        <li><a href="#">Política de Privacidade</a></li>
                        <li><a href="#">Termos de Uso</a></li>
                        <li><a href="#">Trocas e Devoluções</a></li>
                        <li><a href="#">Fale Conosco</a></li>
                    </ul>
                </div>

                <div class="footer-section">
                    <h4>Atendimento</h4>
                    <ul>
                        <li><i class="fas fa-phone"></i>67 99999-9999</li>
                        <li><i class="fas fa-envelope"></i> contato@techhub.com</li>
                        <li><i class="fas fa-clock"></i> Seg-Sex: 9h-18h</li>
                        <li><i class="fas fa-map-marker-alt"></i>Campo Grande - Ms</li>
                    </ul>
                </div>
            </div>

            <div class="footer-bottom">
                <p>&copy; 2025 TechHub. Todos os direitos reservados.</p>
            </div>
        </div>
    </footer>


    <script src="js/app.js"></script>
    <script src="js/carrinho.js"></script>
    <script>

        class Checkout {
            constructor() {
                this.apiBase = '/tables';
                this.carrinho = [];
                this.cupom = '';
                this.desconto = 0;
                this.frete = 0;
                this.init();
            }

            init() {
                this.carregarCarrinho();
                this.configurarEventListeners();
                this.configurarMascaras();
                this.atualizarResumo();
            }

            configurarEventListeners() {

                const form = document.getElementById('checkoutForm');
                if (form) {
                    form.addEventListener('submit', (e) => this.processarPedido(e));
                }


                const metodosPagamento = document.querySelectorAll('input[name="pagamento"]');
                metodosPagamento.forEach(metodo => {
                    metodo.addEventListener('change', (e) => this.alterarMetodoPagamento(e.target.value));
                });


                const cep = document.getElementById('cep');
                if (cep) {
                    cep.addEventListener('blur', () => this.buscarEnderecoPorCep());
                }


                const aplicarCupom = document.getElementById('aplicarCupomCheckout');
                if (aplicarCupom) {
                    aplicarCupom.addEventListener('click', () => this.aplicarCupom());
                }


                const parcelas = document.getElementById('parcelas');
                if (parcelas) {
                    parcelas.addEventListener('change', () => this.atualizarResumo());
                }
            }

            configurarMascaras() {

                const cpf = document.getElementById('cpf');
                if (cpf) {
                    cpf.addEventListener('input', (e) => {
                        e.target.value = this.mascararCPF(e.target.value);
                    });
                }

                // Telefone
                const telefone = document.getElementById('telefone');
                if (telefone) {
                    telefone.addEventListener('input', (e) => {
                        e.target.value = this.mascararTelefone(e.target.value);
                    });
                }


                const cep = document.getElementById('cep');
                if (cep) {
                    cep.addEventListener('input', (e) => {
                        e.target.value = this.mascararCEP(e.target.value);
                    });
                }


                const numeroCartao = document.getElementById('numeroCartao');
                if (numeroCartao) {
                    numeroCartao.addEventListener('input', (e) => {
                        e.target.value = this.mascararCartao(e.target.value);
                    });
                }


                const validadeCartao = document.getElementById('validadeCartao');
                if (validadeCartao) {
                    validadeCartao.addEventListener('input', (e) => {
                        e.target.value = this.mascararValidade(e.target.value);
                    });
                }
            }

            carregarCarrinho() {
                const carrinhoSalvo = localStorage.getItem('techhub_carrinho');
                this.carrinho = carrinhoSalvo ? JSON.parse(carrinhoSalvo) : [];

                if (this.carrinho.length === 0) {
                    alert('Seu carrinho está vazio!');
                    window.location.href = 'carrinho.html';
                    return;
                }

                this.renderizarResumoItens();
            }

            renderizarResumoItens() {
                const container = document.getElementById('resumoItens');
                if (!container) return;

                container.innerHTML = this.carrinho.map(item => `
                    <div class="resumo-item">
                        <div class="resumo-produto">
                            <img src="${item.imagem}" alt="${item.nome}" class="resumo-imagem">
                            <div class="resumo-info">
                                <span class="resumo-nome">${item.nome}</span>
                                <span class="resumo-quantidade">Qtd: ${item.quantidade}</span>
                            </div>
                        </div>
                        <span class="resumo-preco">R$ ${this.formatarPreco(item.preco * item.quantidade)}</span>
                    </div>
                `).join('');
            }

            alterarMetodoPagamento(metodo) {
                const cartaoDetalhes = document.getElementById('cartaoDetalhes');
                const parcelas = document.getElementById('parcelas');
                const cupomInput = document.getElementById('cupomCheckout');

                if (cartaoDetalhes) {
                    cartaoDetalhes.style.display = metodo === 'cartao' ? 'block' : 'none';
                }


                let descontoMetodo = 0;
                switch (metodo) {
                    case 'pix':
                        descontoMetodo = 0.10;
                        break;
                    case 'boleto':
                        descontoMetodo = 0.05;
                        break;
                    default:
                        descontoMetodo = 0;
                }


                const cupomDesconto = this.cupom ? this.calcularDescontoCupom(this.cupom) : 0;
                this.desconto = Math.max(descontoMetodo, cupomDesconto);

                this.atualizarResumo();
            }

            calcularDescontoCupom(cupom) {
                const cupons = {
                    'TECHHUB10': 0.10,
                    'PRIMEIRACOMPRA': 0.15,
                    'BLACKFRIDAY': 0.20,
                    'VIP': 0.25
                };
                return cupons[cupom.toUpperCase()] || 0;
            }

            aplicarCupom() {
                const cupomInput = document.getElementById('cupomCheckout');
                const cupom = cupomInput?.value || '';

                if (!cupom) {
                    alert('Digite um cupom de desconto');
                    return;
                }

                const descontoCupom = this.calcularDescontoCupom(cupom);

                if (descontoCupom > 0) {
                    this.cupom = cupom;

                    if (descontoCupom > this.desconto) {
                        this.desconto = descontoCupom;
                    }
                    this.mostrarNotificacao(`Cupom ${cupom} aplicado com sucesso!`);
                } else {
                    alert('Cupom inválido ou expirado');
                }

                this.atualizarResumo();
            }

            calcularTotal() {
                const subtotal = this.carrinho.reduce((total, item) => total + (item.preco * item.quantidade), 0);
                const descontoValor = subtotal * this.desconto;
                const total = subtotal - descontoValor + this.frete;

                return {
                    subtotal,
                    desconto: descontoValor,
                    frete: this.frete,
                    total
                };
            }

            atualizarResumo() {
                const totais = this.calcularTotal();

                document.getElementById('subtotal').textContent = `R$ ${this.formatarPreco(totais.subtotal)}`;

                const descontoItem = document.getElementById('descontoItem');
                const descontoSpan = document.getElementById('desconto');

                if (totais.desconto > 0) {
                    descontoItem.style.display = 'flex';
                    descontoSpan.textContent = `R$ ${this.formatarPreco(totais.desconto)}`;
                } else {
                    descontoItem.style.display = 'none';
                }

                document.getElementById('frete').textContent = this.frete > 0 ? `R$ ${this.formatarPreco(this.frete)}` : 'Grátis';
                document.getElementById('total').textContent = `R$ ${this.formatarPreco(totais.total)}`;


                const parcelas = document.getElementById('parcelas');
                if (parcelas) {
                    const valorParcela = totais.total / parseInt(parcelas.value);
                    const opcaoSelecionada = parcelas.options[parcelas.selectedIndex];
                    opcaoSelecionada.textContent = `${parcelas.value}x de R$ ${this.formatarPreco(valorParcela)} sem juros`;
                }
            }

            buscarEnderecoPorCep() {
                const cep = document.getElementById('cep')?.value.replace(/\D/g, '');

                if (!cep || cep.length !== 8) return;


                setTimeout(() => {
                    const enderecos = {
                        '01310100': { logradouro: 'Avenida Paulista', bairro: 'Bela Vista', cidade: 'São Paulo', estado: 'SP' },
                        '20040002': { logradouro: 'Rua Uruguaiana', bairro: 'Centro', cidade: 'Rio de Janeiro', estado: 'RJ' },
                        '30110000': { logradouro: 'Avenida Afonso Pena', bairro: 'Centro', cidade: 'Belo Horizonte', estado: 'MG' }
                    };

                    const endereco = enderecos[cep];
                    if (endereco) {
                        document.getElementById('endereco').value = endereco.logradouro;
                        document.getElementById('bairro').value = endereco.bairro;
                        document.getElementById('cidade').value = endereco.cidade;
                        document.getElementById('estado').value = endereco.estado;


                        this.calcularFrete(cep);
                    }
                }, 1000);
            }

            calcularFrete(cep) {
                const regiao = cep.substring(0, 1);
                let freteInfo = {};

                switch (regiao) {
                    case '0':
                    case '1':
                        freteInfo = { valor: 0, tipo: 'Grátis', prazo: 1 };
                        break;
                    case '2':
                    case '3':
                        freteInfo = { valor: 15.90, tipo: 'Expresso', prazo: 2 };
                        break;
                    case '4':
                    case '5':
                        freteInfo = { valor: 29.90, tipo: 'Standard', prazo: 5 };
                        break;
                    default:
                        freteInfo = { valor: 39.90, tipo: 'Standard', prazo: 7 };
                }

                this.frete = freteInfo.valor;
                this.atualizarResumo();


                const freteTexto = document.getElementById('freteTexto');
                if (freteTexto) {
                    freteTexto.textContent = freteInfo.valor === 0 ?
                        'Frete grátis para todo Brasil' :
                        `Frete ${freteInfo.tipo}: R$ ${this.formatarPreco(freteInfo.valor)} (${freteInfo.prazo} dias)`;
                }
            }

            async processarPedido(event) {
                event.preventDefault();

                const formData = new FormData(event.target);
                const pedido = {
                    cliente_nome: formData.get('nomeCompleto'),
                    cliente_email: formData.get('email'),
                    cliente_telefone: formData.get('telefone'),
                    endereco: this.montarEndereco(formData),
                    itens: JSON.stringify(this.carrinho),
                    valor_total: this.calcularTotal().total,
                    status: 'pendente',
                    data_pedido: new Date().toISOString(),
                    observacoes: formData.get('observacoes') || ''
                };


                if (!this.validarDados(pedido)) {
                    return;
                }


                this.mostrarLoading();

                try {

                    const response = await fetch(`${this.apiBase}/pedidos`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(pedido)
                    });

                    if (!response.ok) {
                        throw new Error('Erro ao processar pedido');
                    }

                    const resultado = await response.json();


                    localStorage.removeItem('techhub_carrinho');


                    window.location.href = `confirmacao.html?id=${resultado.id}`;

                } catch (error) {
                    console.error('Erro ao processar pedido:', error);
                    alert('Erro ao processar seu pedido. Por favor, tente novamente.');
                } finally {
                    this.esconderLoading();
                }
            }

            validarDados(pedido) {

                const cpf = document.getElementById('cpf').value;
                if (!this.validarCPF(cpf)) {
                    alert('CPF inválido');
                    return false;
                }


                const email = document.getElementById('email').value;
                if (!this.validarEmail(email)) {
                    alert('E-mail inválido');
                    return false;
                }


                const termos = document.getElementById('termos').checked;
                if (!termos) {
                    alert('Você deve aceitar os termos e condições');
                    return false;
                }

                return true;
            }

            validarCPF(cpf) {
                cpf = cpf.replace(/\D/g, '');
                if (cpf.length !== 11) return false;


                const regex = /^\d{11}$/;
                return regex.test(cpf);
            }

            validarEmail(email) {
                const regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                return regex.test(email);
            }

            montarEndereco(formData) {
                return {
                    cep: formData.get('cep'),
                    logradouro: formData.get('endereco'),
                    numero: formData.get('numero'),
                    complemento: formData.get('complemento') || '',
                    bairro: formData.get('bairro'),
                    cidade: formData.get('cidade'),
                    estado: formData.get('estado')
                };
            }

            mostrarLoading() {
                const loading = document.createElement('div');
                loading.id = 'loadingOverlay';
                loading.className = 'loading-overlay';
                loading.innerHTML = `
                    <div class="loading-content">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>Processando seu pedido...</p>
                    </div>
                `;
                document.body.appendChild(loading);
            }

            esconderLoading() {
                const loading = document.getElementById('loadingOverlay');
                if (loading) {
                    loading.remove();
                }
            }

            mostrarNotificacao(mensagem) {
                const toast = document.createElement('div');
                toast.className = 'toast success';
                toast.innerHTML = `
                    <i class="fas fa-check-circle"></i>
                    <span>${mensagem}</span>
                `;

                document.body.appendChild(toast);

                setTimeout(() => {
                    toast.style.animation = 'fadeOut 0.3s ease-in';
                    setTimeout(() => toast.remove(), 300);
                }, 3000);
            }

            // Máscaras
            mascararCPF(cpf) {
                cpf = cpf.replace(/\D/g, '');
                return cpf.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4');
            }

            mascararTelefone(telefone) {
                telefone = telefone.replace(/\D/g, '');
                if (telefone.length <= 10) {
                    return telefone.replace(/(\d{2})(\d{4})(\d{0,4})/, '($1) $2-$3');
                } else {
                    return telefone.replace(/(\d{2})(\d{5})(\d{0,4})/, '($1) $2-$3');
                }
            }

            mascararCEP(cep) {
                cep = cep.replace(/\D/g, '');
                return cep.replace(/(\d{5})(\d{3})/, '$1-$2');
            }

            mascararCartao(cartao) {
                cartao = cartao.replace(/\D/g, '');
                return cartao.replace(/(\d{4})(\d{4})(\d{4})(\d{4})/, '$1 $2 $3 $4');
            }

            mascararValidade(validade) {
                validade = validade.replace(/\D/g, '');
                return validade.replace(/(\d{2})(\d{2})/, '$1/$2');
            }

            formatarPreco(preco) {
                return new Intl.NumberFormat('pt-BR', {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                }).format(preco);
            }
        }

        // Inicializar quando o DOM carregar
        document.addEventListener('DOMContentLoaded', () => {
            window.checkout = new Checkout();
        });

        // Adicionar estilos específicos do checkout
        const checkoutStyles = `
            <style>
                /* Estilos específicos do checkout */
                .checkout-progress {
                    background: var(--dark-card);
                    padding: 2rem 0;
                    border-bottom: 1px solid var(--dark-border);
                }

                .progress-steps {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    max-width: 800px;
                    margin: 0 auto;
                    position: relative;
                }

                .progress-steps::before {
                    content: '';
                    position: absolute;
                    top: 50%;
                    left: 0;
                    right: 0;
                    height: 2px;
                    background: var(--dark-border);
                    z-index: 1;
                }

                .step {
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    position: relative;
                    z-index: 2;
                    flex: 1;
                }

                .step-icon {
                    width: 50px;
                    height: 50px;
                    border-radius: 50%;
                    background: var(--dark-bg);
                    border: 2px solid var(--dark-border);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    margin-bottom: 0.5rem;
                    transition: var(--transition);
                }

                .step.active .step-icon {
                    background: var(--primary-color);
                    border-color: var(--primary-color);
                    color: white;
                }

                .step.completed .step-icon {
                    background: var(--success-color);
                    border-color: var(--success-color);
                    color: white;
                }

                .step-label {
                    font-size: 0.875rem;
                    color: var(--text-secondary);
                    text-align: center;
                }

                .step.active .step-label {
                    color: var(--primary-color);
                    font-weight: 600;
                }

                .checkout-section {
                    padding: 4rem 0;
                    min-height: 70vh;
                }

                .checkout-container {
                    display: grid;
                    grid-template-columns: 1fr 400px;
                    gap: 3rem;
                    align-items: start;
                }

                .checkout-form {
                    background: var(--dark-card);
                    border-radius: var(--border-radius);
                    padding: 2rem;
                    border: 1px solid var(--dark-border);
                }

                .form-section {
                    margin-bottom: 2rem;
                }

                .form-section-title {
                    display: flex;
                    align-items: center;
                    gap: 0.75rem;
                    font-size: 1.25rem;
                    margin-bottom: 1.5rem;
                    color: var(--text-primary);
                }

                .form-section-title i {
                    color: var(--primary-color);
                }

                .form-row {
                    display: grid;
                    grid-template-columns: 1fr 1fr;
                    gap: 1rem;
                    margin-bottom: 1rem;
                }

                .form-group {
                    display: flex;
                    flex-direction: column;
                }

                .form-group label {
                    margin-bottom: 0.5rem;
                    font-weight: 500;
                    color: var(--text-primary);
                }

                .form-group input,
                .form-group select,
                .form-group textarea {
                    padding: 0.75rem;
                    background: var(--dark-bg);
                    border: 1px solid var(--dark-border);
                    border-radius: var(--border-radius);
                    color: var(--text-primary);
                    transition: var(--transition);
                }

                .form-group input:focus,
                .form-group select:focus,
                .form-group textarea:focus {
                    outline: none;
                    border-color: var(--primary-color);
                    box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
                }

                .payment-methods {
                    display: flex;
                    flex-direction: column;
                    gap: 1rem;
                    margin-bottom: 1.5rem;
                }

                .payment-method {
                    display: flex;
                    align-items: center;
                    gap: 1rem;
                }

                .payment-label {
                    display: flex;
                    align-items: center;
                    gap: 1rem;
                    padding: 1rem;
                    background: var(--dark-bg);
                    border: 1px solid var(--dark-border);
                    border-radius: var(--border-radius);
                    cursor: pointer;
                    transition: var(--transition);
                    flex: 1;
                }

                .payment-label:hover {
                    border-color: var(--primary-color);
                }

                .payment-method input[type="radio"]:checked + .payment-label {
                    border-color: var(--primary-color);
                    background: rgba(37, 99, 235, 0.1);
                }

                .payment-details {
                    background: var(--dark-bg);
                    border-radius: var(--border-radius);
                    padding: 1.5rem;
                    border: 1px solid var(--dark-border);
                    margin-top: 1rem;
                }

                .checkbox-group {
                    display: flex;
                    align-items: flex-start;
                    gap: 0.75rem;
                    margin: 1.5rem 0;
                }

                .checkbox-group input[type="checkbox"] {
                    margin-top: 0.25rem;
                }

                .checkbox-group label {
                    color: var(--text-secondary);
                    font-size: 0.9rem;
                    line-height: 1.5;
                }

                .checkbox-group a {
                    color: var(--primary-color);
                    text-decoration: none;
                }

                .checkbox-group a:hover {
                    text-decoration: underline;
                }

                .form-actions {
                    display: flex;
                    gap: 1rem;
                    align-items: center;
                    margin-top: 2rem;
                }

                .checkout-resumo {
                    background: var(--dark-card);
                    border-radius: var(--border-radius);
                    padding: 2rem;
                    border: 1px solid var(--dark-border);
                    position: sticky;
                    top: 2rem;
                }

                .resumo-header {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    margin-bottom: 1.5rem;
                    padding-bottom: 1rem;
                    border-bottom: 1px solid var(--dark-border);
                }

                .editar-carrinho {
                    color: var(--primary-color);
                    text-decoration: none;
                    font-size: 0.9rem;
                    display: flex;
                    align-items: center;
                    gap: 0.5rem;
                }

                .editar-carrinho:hover {
                    text-decoration: underline;
                }

                .resumo-itens {
                    margin-bottom: 1.5rem;
                }

                .resumo-item {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    padding: 0.75rem 0;
                    border-bottom: 1px solid var(--dark-border);
                }

                .resumo-produto {
                    display: flex;
                    align-items: center;
                    gap: 0.75rem;
                    flex: 1;
                }

                .resumo-imagem {
                    width: 40px;
                    height: 40px;
                    object-fit: cover;
                    border-radius: var(--border-radius);
                    border: 1px solid var(--dark-border);
                }

                .resumo-info {
                    display: flex;
                    flex-direction: column;
                }

                .resumo-nome {
                    font-size: 0.9rem;
                    font-weight: 500;
                    color: var(--text-primary);
                    line-height: 1.3;
                }

                .resumo-quantidade {
                    font-size: 0.8rem;
                    color: var(--text-muted);
                }

                .resumo-preco {
                    font-weight: 600;
                    color: var(--text-primary);
                }

                .resumo-cupom {
                    margin: 1.5rem 0;
                    padding: 1rem;
                    background: var(--dark-bg);
                    border-radius: var(--border-radius);
                    border: 1px solid var(--dark-border);
                }

                .resumo-frete {
                    margin: 1.5rem 0;
                    padding: 1rem;
                    background: var(--dark-bg);
                    border-radius: var(--border-radius);
                    border: 1px solid var(--dark-border);
                }

                .frete-info {
                    display: flex;
                    align-items: center;
                    gap: 0.5rem;
                    color: var(--text-secondary);
                    font-size: 0.9rem;
                }

                .resumo-total {
                    margin: 1.5rem 0;
                    padding-top: 1rem;
                    border-top: 2px solid var(--primary-color);
                }

                .total-item {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    padding: 0.5rem 0;
                    font-size: 0.9rem;
                    color: var(--text-secondary);
                }

                .total-item.final {
                    font-size: 1.25rem;
                    font-weight: 700;
                    color: var(--text-primary);
                    margin-top: 0.5rem;
                    padding-top: 0.5rem;
                    border-top: 1px solid var(--dark-border);
                }

                .resumo-seguranca {
                    margin-top: 1.5rem;
                    padding-top: 1.5rem;
                    border-top: 1px solid var(--dark-border);
                }

                .seguranca-item {
                    display: flex;
                    align-items: center;
                    gap: 0.75rem;
                    margin-bottom: 0.75rem;
                    color: var(--text-secondary);
                    font-size: 0.875rem;
                }

                .seguranca-item:last-child {
                    margin-bottom: 0;
                }

                .seguranca-item i {
                    color: var(--success-color);
                }

                .loading-overlay {
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: rgba(0, 0, 0, 0.8);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 9999;
                }

                .loading-content {
                    background: var(--dark-card);
                    padding: 2rem;
                    border-radius: var(--border-radius);
                    text-align: center;
                    border: 1px solid var(--dark-border);
                }

                .loading-content i {
                    font-size: 2rem;
                    color: var(--primary-color);
                    margin-bottom: 1rem;
                }

                .loading-content p {
                    color: var(--text-primary);
                    font-size: 1.1rem;
                }

                /* Responsive Design */
                @media (max-width: 1024px) {
                    .checkout-container {
                        grid-template-columns: 1fr;
                        gap: 2rem;
                    }

                    .checkout-resumo {
                        position: static;
                    }
                }

                @media (max-width: 768px) {
                    .progress-steps {
                        flex-wrap: wrap;
                        gap: 1rem;
                    }

                    .step-label {
                        font-size: 0.75rem;
                    }

                    .form-row {
                        grid-template-columns: 1fr;
                        gap: 1rem;
                    }

                    .payment-methods {
                        gap: 0.75rem;
                    }

                    .payment-label {
                        padding: 0.75rem;
                        font-size: 0.9rem;
                    }

                    .form-actions {
                        flex-direction: column;
                        align-items: stretch;
                    }

                    .btn-large {
                        padding: 1rem 1.5rem;
                        font-size: 1rem;
                    }

                    .resumo-header {
                        flex-direction: column;
                        align-items: flex-start;
                        gap: 0.5rem;
                    }

                    .cupom-input-group {
                        flex-direction: column;
                    }
                }

                @media (max-width: 480px) {
                    .checkout-form {
                        padding: 1rem;
                    }

                    .step-icon {
                        width: 40px;
                        height: 40px;
                        font-size: 1rem;
                    }

                    .step-label {
                        font-size: 0.7rem;
                    }

                    .form-section-title {
                        font-size: 1.1rem;
                    }

                    .resumo-header h3 {
                        font-size: 1.1rem;
                    }

                    .total-item.final {
                        font-size: 1.1rem;
                    }
                }
            </style>
        `;

        document.head.insertAdjacentHTML('beforeend', checkoutStyles);
    </script>
</body>

</html>